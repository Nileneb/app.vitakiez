# docker/nginx/Dockerfile
# This Dockerfile copies pre-built assets from the php-fpm image to ensure consistency

# Build the php-fpm image first to get consistent assets
FROM appvitakiez-php-fpm:latest AS php_fpm_assets

# Stage: Nginx production image
FROM nginx:alpine
# Custom Nginx config
COPY ./docker/common/nginx/nginx.conf /etc/nginx/nginx.conf
# Copy built assets from php-fpm image (built only once, guaranteed same hash)
COPY --from=php_fpm_assets /var/www/public /var/www/public
WORKDIR /var/www/public
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
